$(document).ready((function(){var e,t=[],n=[];function s(){var e=""!==$('input[name="user-name"]').val().trim();0===$(".constructor-card:visible input:visible").filter((function(){return""===$(this).val().trim()})).length&&e&&t.length>0?$(".constructor__submit").show():$(".constructor__submit").hide()}$(".test__wrapper").on("click",".constructor-card__save",(function(e){e.preventDefault();var o=$(this).closest(".constructor-card"),a=$(".constructor-card").index(o)-1,r=function(e){var t=e.find("input:visible").filter((function(){return""===$(this).val().trim()}));return 0===t.length}(o);if(r){var i={};i.questionText=o.find('input[name="question-text"]').val();var c=o.find('select[name="type"]').val();switch(i.questionType=c,c){case"text":i.answer=o.find('input[name="answer-text"]').val();break;case"number":i.answer=o.find('input[name="answer-number"]').val();break;case"select":i.answer=o.find('select[name="answer-select"]').val();break;case"date":i.answer=o.find('input[name="answer-date"]').val()}var l=n[a];console.log(l),l&&(i.correct=l.correct,console.log("exec2")),t[a]?(t.splice(a,1,i),console.log("Replaced at:",a)):t.push(i),s(),console.log("Answer saved:",i),console.log("All answers:",t)}else alert("Заполните все поля перед сохранением.")})),$.getJSON("json/test.json",(function(e){$(".test__test-name-field input").val(e.testName),(n=e.questions).forEach((function(e,t){var n=$("#question-template").clone().removeAttr("id").removeAttr("style");if(n.find(".constructor-card__number").text("Вопрос "+(t+1)+":"),n.find(".constructor-card__field-text[name='question-text']").val(e.title),n.find("select[name='type']").val(e.type),"text"===e.type)n.find(".question--text").show();else if("number"===e.type)n.find(".question--number").show();else if("select"===e.type){n.find(".question--select").show();var s=n.find(".question--select select");e.options.forEach((function(e){s.append($("<option>",{value:e,text:e}))}))}else"date"===e.type&&n.find(".question--date").show();$(".test__wrapper").append(n)}))})),$('input[name="user-name"]').on("input",(function(){s()})),$(".constructor__submit").on("click",(function(n){n.preventDefault(),testName=$('input[name="test-name"]').val().trim(),e=$('input[name="user-name"]').val().trim(),console.log("Название теста:",testName),console.log("Имя пользователя:",e),console.log("Массив ответов:",t),console.log("Форматирую объект");var s,o,a,r,i,c={testName:testName,userName:e,answers:t},l=JSON.stringify(c);console.log("JSON объект:",l),s=l,o="answers.json",a="text/plain",r=document.createElement("a"),i=new Blob([s],{type:a}),r.href=URL.createObjectURL(i),r.download=o,r.click()})),window.addEventListener("beforeunload",(function(n){""!==t&&""!==e&&(n.preventDefault(),n.returnValue="")}))}));