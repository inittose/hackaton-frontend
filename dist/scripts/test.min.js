$(document).ready((function(){var e,t=[];function n(){var e=""!==$('input[name="user-name"]').val().trim();0===$(".constructor-card:visible input:visible").filter((function(){return""===$(this).val().trim()})).length&&e&&t.length>0?$(".constructor__submit").show():$(".constructor__submit").hide()}$(".test__wrapper").on("click",".constructor-card__save",(function(e){e.preventDefault();var s=$(this).closest(".constructor-card"),a=$(".constructor-card").index(s)-1,o=function(e){var t=e.find("input:visible").filter((function(){return""===$(this).val().trim()}));return 0===t.length}(s);if(o){var r={};r.questionText=s.find('input[name="question-text"]').val();var i=s.find('select[name="type"]').val();switch(r.questionType=i,i){case"text":r.answer=s.find('input[name="answer-text"]').val();break;case"number":r.answer=s.find('input[name="answer-number"]').val();break;case"select":r.answer=s.find('select[name="answer-select"]').val();break;case"date":r.answer=s.find('input[name="answer-date"]').val()}t[a]?(t.splice(a,1,r),console.log("Replaced at:",a)):t.push(r),n(),console.log("Answer saved:",r),console.log("All answers:",t)}else alert("Заполните все поля перед сохранением.")})),$.getJSON("json/test.json",(function(e){$(".test__test-name-field input").val(e.testName),e.questions.forEach((function(e,t){var n=$("#question-template").clone().removeAttr("id").removeAttr("style");if(n.find(".constructor-card__number").text("Вопрос "+(t+1)+":"),n.find(".constructor-card__field-text[name='question-text']").val(e.title),n.find("select[name='type']").val(e.type),"text"===e.type)n.find(".question--text").show();else if("number"===e.type)n.find(".question--number").show();else if("select"===e.type){n.find(".question--select").show();var s=n.find(".question--select select");e.options.forEach((function(e){s.append($("<option>",{value:e,text:e}))}))}else"date"===e.type&&n.find(".question--date").show();$(".test__wrapper").append(n)}))})),$('input[name="user-name"]').on("input",(function(){n()})),$(".constructor__submit").on("click",(function(n){n.preventDefault(),testName=$('input[name="test-name"]').val().trim(),e=$('input[name="user-name"]').val().trim(),console.log("Название теста:",testName),console.log("Имя пользователя:",testName),console.log("Массив ответов:",t),console.log("Форматирую объект");var s,a,o,r,i,l={testName:testName,userName:e,answers:t},c=JSON.stringify(l);console.log("JSON объект:",c),s=c,a="answers.json",o="text/plain",r=document.createElement("a"),i=new Blob([s],{type:o}),r.href=URL.createObjectURL(i),r.download=a,r.click()})),window.addEventListener("beforeunload",(function(n){""!==t&&""!==e&&(n.preventDefault(),n.returnValue="")}))}));