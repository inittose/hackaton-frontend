$(document).ready((function(){var t,e=[];function n(){var t=""!==$('input[name="test-name"]').val().trim();0===$(".constructor-card:visible input:visible").filter((function(){return""===$(this).val().trim()})).length&&t&&e.length>0?$(".constructor__submit").show():$(".constructor__submit").hide()}$(".constructor__wrapper").on("click",".constructor-card__save",(function(t){t.preventDefault();var o=$(this).closest(".constructor-card"),r=$(".constructor-card").index(o)-1,c=function(t){var e=t.find("input:visible").filter((function(){return""===$(this).val().trim()}));return 0===e.length}(o);if(c){var i={};i.title=o.find('input[name="question-text"]').val(),i.type=o.find('select[name="type"]').val(),"select"===i.type?(i.options=[],o.find('input[name^="select"]').each((function(t,e){i.options.push($(e).val())})),i.correct=o.find('input[name="answer-select"]').val()):"date"===i.type?i.correct=o.find('input[type="date"]').val():"number"===i.type?i.correct=o.find('input[name="answer-number"]').val():"text"===i.type&&(i.correct=o.find('input[name="answer-text"]').val()),e[r]?(e.splice(r,1,i),console.log("Replaced at:",r)):e.push(i),n(),console.log("Question saved:",i),console.log("All questions:",e)}else alert("Заполните все поля перед сохранением.")})),$(".constructor__wrapper").on("change",".field__select",(function(){var t=$(this).val(),e=$(this).closest(".constructor-card");e.find(".question").hide(),e.find(".question--"+t).show()})),$(".constructor__append").on("click",(function(t){var e;t.preventDefault(),e=$("#question-template").clone().removeAttr("id").removeAttr("style"),$(".constructor__wrapper").append(e),e.find('input[type="text"]').val(""),e.find("select").val("text"),e.find(".question").hide(),e.find(".question--text").show()})),$('input[name="test-name"]').on("input",(function(){n()})),$(".constructor__wrapper").on("click",".constructor-card__discard",(function(t){t.preventDefault();var o=$(this).closest(".constructor-card"),r=$(".constructor-card").index(o)-1;e.splice(r,1),o.remove(),n(),console.log("Question deleted"),console.log("All questions:",e)})),$(".constructor__submit").on("click",(function(n){n.preventDefault(),t=$('input[name="test-name"]').val().trim(),console.log("Название теста:",t),console.log("Массив вопросов:",e),console.log("Форматирую объект");var o,r,c,i,s,l={testName:t,questions:e},a=JSON.stringify(l);console.log("JSON объект:",a),o=a,r="test.json",c="text/plain",i=document.createElement("a"),s=new Blob([o],{type:c}),i.href=URL.createObjectURL(s),i.download=r,i.click()})),window.addEventListener("beforeunload",(function(n){""!==e&&""!==t&&(n.preventDefault(),n.returnValue="")}))}));